{"version":3,"sources":["commands/publish-info.js"],"names":["HORIZ_CELL_WIDTH_SMALL","HORIZ_CELL_WIDTH_BIG","VERSION","program","command","alias","description","option","parseInt","asyncActionProjectDir","projectDir","options","count","isNaN","error","process","exit","formData","append","getSlugAsync","releaseChannel","platform","callMethodAsync","result","raw","console","log","queryResult","length","sampleItem","generalTableString","printTableJson","fullName","headers","colWidths","bigCells","forEach","has","header","push","tableString","printTableJsonArray","publishId","manifest","manifestTableString"],"mappings":"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","file":"../../commands/publish-info.js","sourcesContent":["/**\n * @flow\n */\n\nimport { Api, Project, FormData } from 'xdl';\nimport log from '../log';\nimport * as table from '../commands/utils/cli-table';\n\nconst HORIZ_CELL_WIDTH_SMALL = 15;\nconst HORIZ_CELL_WIDTH_BIG = 40;\nconst VERSION = 2;\n\nexport default (program: any) => {\n  program\n    .command('publish:history [project-dir]')\n    .alias('ph')\n    .description('View a log of your published releases.')\n    .option(\n      '-c, --release-channel <channel-name>',\n      'Filter by release channel. If this flag is not included, the most recent publications will be shown.'\n    )\n    .option(\n      '-count, --count <number-of-logs>',\n      'Number of logs to view, maximum 100, default 5.',\n      parseInt\n    )\n    .option('-p, --platform <ios|android>', 'Filter by platform, android or ios.')\n    .option('-r, --raw', 'Produce some raw output.')\n    .asyncActionProjectDir(async (projectDir, options) => {\n      if (options.count && (isNaN(options.count) || options.count < 1 || options.count > 100)) {\n        log.error('-n must be a number between 1 and 100 inclusive');\n        process.exit(1);\n      }\n\n      // TODO(ville): move request from multipart/form-data to JSON once supported by the endpoint.\n      let formData = new FormData();\n      formData.append('queryType', 'history');\n      formData.append('slug', await Project.getSlugAsync(projectDir, options));\n      formData.append('version', VERSION);\n      if (options.releaseChannel) {\n        formData.append('releaseChannel', options.releaseChannel);\n      }\n      if (options.count) {\n        formData.append('count', options.count);\n      }\n      if (options.platform) {\n        formData.append('platform', options.platform);\n      }\n\n      let result = await Api.callMethodAsync('publishInfo', [], 'post', null, {\n        formData,\n      });\n\n      if (options.raw) {\n        console.log(JSON.stringify(result));\n        return;\n      }\n\n      if (result.queryResult && result.queryResult.length > 0) {\n        // Print general publication info\n        let sampleItem = result.queryResult[0]; // get a sample item\n        let generalTableString = table.printTableJson(\n          {\n            fullName: sampleItem.fullName,\n          },\n          'General Info'\n        );\n        console.log(generalTableString);\n\n        // Print info specific to each publication\n        let headers = [\n          'publishedTime',\n          'appVersion',\n          'sdkVersion',\n          'platform',\n          'channel',\n          'channelId',\n          'publicationId',\n        ];\n\n        // colWidths contains the cell size of each header\n        let colWidths = [];\n        let bigCells = new Set(['publicationId', 'channelId', 'publishedTime']);\n        headers.forEach(header => {\n          bigCells.has(header)\n            ? colWidths.push(HORIZ_CELL_WIDTH_BIG)\n            : colWidths.push(HORIZ_CELL_WIDTH_SMALL);\n        });\n        let tableString = table.printTableJsonArray(headers, result.queryResult, colWidths);\n        console.log(tableString);\n      } else {\n        log.error('No records found matching your query.');\n      }\n    });\n  program\n    .command('publish:details [project-dir]')\n    .alias('pd')\n    .description('View the details of a published release.')\n    .option('--publish-id <publish-id>', 'Publication id. (Required)')\n    .option('-r, --raw', 'Produce some raw output.')\n    .asyncActionProjectDir(async (projectDir, options) => {\n      if (!options.publishId) {\n        log.error('publishId must be specified.');\n        process.exit(1);\n      }\n\n      let formData = new FormData();\n      formData.append('queryType', 'details');\n      formData.append('publishId', options.publishId);\n      formData.append('slug', await Project.getSlugAsync(projectDir, options));\n\n      let result = await Api.callMethodAsync('publishInfo', null, 'post', null, {\n        formData,\n      });\n\n      if (options.raw) {\n        console.log(JSON.stringify(result));\n        return;\n      }\n\n      if (result.queryResult) {\n        let queryResult = result.queryResult;\n        let manifest = queryResult.manifest;\n        delete queryResult.manifest;\n\n        // Print general release info\n        let generalTableString = table.printTableJson(queryResult, 'Release Description');\n        console.log(generalTableString);\n\n        // Print manifest info\n        let manifestTableString = table.printTableJson(manifest, 'Manifest Details');\n        console.log(manifestTableString);\n      } else {\n        log.error('No records found matching your query.');\n      }\n    });\n};\n"],"sourceRoot":"/exp@55.0.5/src"}