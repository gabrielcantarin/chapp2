{"version":3,"sources":["eject.js"],"names":["filesUsingExpoSdk","filesWithExpo","usingExpo","length","expoSdkWarning","chalk","bold","filename","cyan","yellow","italic","reactNativeOptionMessage","questions","type","name","message","default","choices","value","inquirer","prompt","ejectMethod","useYarn","process","cwd","npmOrYarn","JSON","fse","readFile","path","resolve","appJson","parse","pkgJson","newName","newDisplayName","displayName","expName","expo","stripDashes","validate","s","indexOf","enteredName","enteredDisplayname","writeFile","green","ejectCommand","ejectArgs","spawn","sync","stdio","status","red","exit","newDevDependencies","projectBabelPath","exists","projectBabelRc","toString","babelRcJson","presets","includes","map","preset","push","main","dependencies","devDependencies","scripts","start","ios","android","test","jest","eject","lolThatsSomeComplexCode","rimraf","args","stdin","stderr","console","error","findJavaScriptProjectFilesInRoot","projectJsFiles","all","f","buf","i","contents","jsFileContents","filesUsingExpo","requires","matchRequire","findAll","sort","root","stat","stats","isFile","endsWith","isDirectory","readdir","children","join","jsFilesInChildren","concat","apply","ret","c","then","catch","e"],"mappings":"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","file":"eject.js","sourcesContent":["// @flow\n\nimport chalk from 'chalk';\nimport fse from 'fs-extra';\nimport inquirer from 'inquirer';\nimport matchRequire from 'match-require';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport spawn from 'cross-spawn';\nimport log from '../util/log';\nimport { hasYarn } from '../util/pm';\n\nimport { detach } from '../util/expo';\n\nasync function eject() {\n  try {\n    const filesWithExpo = await filesUsingExpoSdk();\n    const usingExpo = filesWithExpo.length > 0;\n\n    let expoSdkWarning;\n    if (usingExpo) {\n      expoSdkWarning = `${chalk.bold('Warning!')} We found at least one file where your project imports the Expo SDK:\n`;\n\n      for (let filename of filesWithExpo) {\n        expoSdkWarning += `  ${chalk.cyan(filename)}\\n`;\n      }\n\n      expoSdkWarning += `\n${chalk.yellow.bold('If you choose the \"plain\" React Native option below, these imports will stop working.')}`;\n    } else {\n      expoSdkWarning = `\\\nWe didn't find any uses of the Expo SDK in your project, so you should be fine to eject to\n\"Plain\" React Native. (This check isn't very sophisticated, though.)`;\n    }\n\n    log(\n      `\n${expoSdkWarning}\n\nWe ${chalk.italic('strongly')} recommend that you read this document before you proceed:\n  ${chalk.cyan('https://github.com/react-community/create-react-native-app/blob/master/EJECTING.md')}\n\nEjecting is permanent! Please be careful with your selection.\n`\n    );\n\n    let reactNativeOptionMessage = \"React Native: I'd like a regular React Native project.\";\n\n    if (usingExpo) {\n      reactNativeOptionMessage = chalk.italic(\n        \"(WARNING: See above message for why this option may break your project's build)\\n  \"\n      ) + reactNativeOptionMessage;\n    }\n\n    const questions = [\n      {\n        type: 'list',\n        name: 'ejectMethod',\n        message: 'How would you like to eject from create-react-native-app?',\n        default: usingExpo ? 'expoKit' : 'raw',\n        choices: [\n          {\n            name: reactNativeOptionMessage,\n            value: 'raw',\n          },\n          {\n            name: \"ExpoKit: I'll create or log in with an Expo account to use React Native and the Expo SDK.\",\n            value: 'expoKit',\n          },\n          {\n            name: \"Cancel: I'll continue with my current project structure.\",\n            value: 'cancel',\n          },\n        ],\n      },\n    ];\n\n    const { ejectMethod } = await inquirer.prompt(questions);\n\n    if (ejectMethod === 'raw') {\n      const useYarn = hasYarn(process.cwd());\n      const npmOrYarn = useYarn ? 'yarn' : 'npm';\n      const appJson = JSON.parse(await fse.readFile(path.resolve('app.json')));\n      const pkgJson = JSON.parse(await fse.readFile(path.resolve('package.json')));\n      let {\n        name: newName,\n        displayName: newDisplayName,\n        expo: { name: expName },\n      } = appJson;\n\n      // we ask user to provide a project name (default is package name stripped of dashes)\n      // but we want to infer some good default choices, especially if they've set them up in app.json\n      if (!newName) {\n        newName = stripDashes(pkgJson.name);\n      }\n\n      if (!newDisplayName && expName) {\n        newDisplayName = expName;\n      }\n\n      log(\"We have a couple of questions to ask you about how you'd like to name your app:\");\n      const { enteredName, enteredDisplayname } = await inquirer.prompt([\n        {\n          name: 'enteredDisplayname',\n          message: \"What should your app appear as on a user's home screen?\",\n          default: newDisplayName,\n          validate: s => {\n            return s.length > 0;\n          },\n        },\n        {\n          name: 'enteredName',\n          message: 'What should your Android Studio and Xcode projects be called?',\n          default: newName,\n          validate: s => {\n            return s.length > 0 && s.indexOf('-') === -1 && s.indexOf(' ') === -1;\n          },\n        },\n      ]);\n\n      appJson.name = enteredName;\n      appJson.displayName = enteredDisplayname;\n\n      log('Writing your selections to app.json...');\n      // write the updated app.json file\n      await fse.writeFile(path.resolve('app.json'), JSON.stringify(appJson, null, 2));\n      log(chalk.green('Wrote to app.json, please update it manually in the future.'));\n\n      const ejectCommand = 'node';\n      const ejectArgs = [\n        path.resolve('node_modules', 'react-native', 'local-cli', 'cli.js'),\n        'eject',\n      ];\n\n      const { status } = spawn.sync(ejectCommand, ejectArgs, {\n        stdio: 'inherit',\n      });\n\n      if (status !== 0) {\n        log(chalk.red(`Eject failed with exit code ${status}, see above output for any issues.`));\n        log(chalk.yellow('You may want to delete the `ios` and/or `android` directories.'));\n        process.exit(1);\n      } else {\n        log('Successfully copied template native code.');\n      }\n\n      const newDevDependencies = [];\n      // Try to replace the Babel preset.\n      try {\n        const projectBabelPath = path.resolve('.babelrc');\n        // If .babelrc doesn't exist, the app is using the default config and\n        // editing the config is not necessary.\n        if (await fse.exists(projectBabelPath)) {\n          const projectBabelRc = (await fse.readFile(projectBabelPath)).toString();\n\n          // We assume the .babelrc is valid JSON. If we can't parse it (e.g. if\n          // it's JSON5) the error is caught and a message asking to change it\n          // manually gets printed.\n          const babelRcJson = JSON.parse(projectBabelRc);\n          if (babelRcJson.presets && babelRcJson.presets.includes('babel-preset-expo')) {\n            babelRcJson.presets = babelRcJson.presets.map(\n              preset =>\n                preset === 'babel-preset-expo'\n                  ? 'babel-preset-react-native-stage-0/decorator-support'\n                  : preset\n            );\n            await fse.writeFile(projectBabelPath, JSON.stringify(babelRcJson, null, 2));\n            newDevDependencies.push('babel-preset-react-native-stage-0');\n            log(\n              chalk.green(\n                `Babel preset changed to \\`babel-preset-react-native-stage-0/decorator-support\\`.`\n              )\n            );\n          }\n        }\n      } catch (e) {\n        log(\n          chalk.yellow(\n            `We had an issue preparing your .babelrc for ejection.\nIf you have a .babelrc in your project, make sure to change the preset\nfrom \\`babel-preset-expo\\` to \\`babel-preset-react-native-stage-0/decorator-support\\`.`\n          )\n        );\n        log(chalk.red(e));\n      }\n\n      delete pkgJson.main;\n\n      // NOTE: expo won't work after performing a raw eject, so we should delete this\n      // it will be a better error message for the module to not be found than for whatever problems\n      // missing native modules will cause\n      delete pkgJson.dependencies.expo;\n      delete pkgJson.devDependencies['react-native-scripts'];\n      delete pkgJson.devDependencies['jest-expo'];\n\n      pkgJson.scripts.start = 'react-native start';\n      pkgJson.scripts.ios = 'react-native run-ios';\n      pkgJson.scripts.android = 'react-native run-android';\n      pkgJson.scripts.test = 'jest';\n\n      newDevDependencies.push('jest');\n\n      if (pkgJson.jest.preset === 'jest-expo') {\n        pkgJson.jest.preset = 'react-native';\n        newDevDependencies.push('jest-react-native');\n      } else {\n        log(\n          `${chalk.bold('Warning')}: it looks like you've changed the Jest preset from jest-expo to ${pkgJson.jest.preset}. We recommend you make sure this Jest preset is compatible with ejected apps.`\n        );\n      }\n\n      // no longer relevant to an ejected project (maybe build is?)\n      delete pkgJson.scripts.eject;\n\n      log(`Updating your ${npmOrYarn} scripts in package.json...`);\n\n      await fse.writeFile(path.resolve('package.json'), JSON.stringify(pkgJson, null, 2));\n\n      log(chalk.green('Your package.json is up to date!'));\n\n      log(`Adding entry point...`);\n\n      const lolThatsSomeComplexCode = `import { AppRegistry } from 'react-native';\nimport App from './App';\nAppRegistry.registerComponent('${newName}', () => App);\n`;\n\n      await fse.writeFile(path.resolve('index.js'), lolThatsSomeComplexCode);\n\n      log(chalk.green('Added new entry points!'));\n\n      log(\n        `\nNote that using \\`${npmOrYarn} start\\` will now require you to run Xcode and/or\nAndroid Studio to build the native code for your project.`\n      );\n\n      log('Removing node_modules...');\n      rimraf.sync(path.resolve('node_modules'));\n      if (useYarn) {\n        log('Installing packages with yarn...');\n        const args = newDevDependencies.length > 0 ? ['add', '--dev', ...newDevDependencies] : [];\n        spawn.sync('yarnpkg', args, { stdio: 'inherit' });\n      } else {\n        // npm prints the whole package tree to stdout unless we ignore it.\n        const stdio = [process.stdin, 'ignore', process.stderr];\n\n        log('Installing existing packages with npm...');\n        spawn.sync('npm', ['install'], { stdio });\n\n        if (newDevDependencies.length > 0) {\n          log('Installing new packages with npm...');\n          spawn.sync('npm', ['install', '--save-dev', ...newDevDependencies], {\n            stdio,\n          });\n        }\n      }\n    } else if (ejectMethod === 'expoKit') {\n      await detach();\n    } else {\n      // we don't want to print the survey for cancellations\n      log('OK! If you change your mind you can run this command again.');\n      return;\n    }\n\n    log(\n      `${chalk.green('Ejected successfully!')}\nPlease consider letting us know why you ejected in this survey:\n  ${chalk.cyan('https://goo.gl/forms/iD6pl218r7fn9N0d2')}`\n    );\n  } catch (e) {\n    console.error(chalk.red(`Error running eject: ${e}`));\n  }\n}\n\nasync function filesUsingExpoSdk(): Promise<Array<string>> {\n  const projectJsFiles = await findJavaScriptProjectFilesInRoot(process.cwd());\n\n  const jsFileContents = (await Promise.all(\n    projectJsFiles.map(f => fse.readFile(f))\n  )).map((buf, i) => {\n    return {\n      filename: projectJsFiles[i],\n      contents: buf.toString(),\n    };\n  });\n\n  const filesUsingExpo = [];\n\n  for (let { filename, contents } of jsFileContents) {\n    const requires = matchRequire.findAll(contents);\n\n    if (requires.includes('expo')) {\n      filesUsingExpo.push(filename);\n    }\n  }\n\n  filesUsingExpo.sort();\n\n  return filesUsingExpo;\n}\n\nfunction stripDashes(s: string): string {\n  let ret = '';\n\n  for (let c of s) {\n    if (c !== ' ' && c !== '-') {\n      ret += c;\n    }\n  }\n\n  return ret;\n}\n\nasync function findJavaScriptProjectFilesInRoot(root: string): Promise<Array<string>> {\n  // ignore node_modules\n  if (root.includes('node_modules')) {\n    return [];\n  }\n\n  const stats = await fse.stat(root);\n\n  if (stats.isFile()) {\n    if (root.endsWith('.js')) {\n      return [root];\n    } else {\n      return [];\n    }\n  } else if (stats.isDirectory()) {\n    const children = await fse.readdir(root);\n\n    // we want to do this concurrently in large project folders\n    const jsFilesInChildren = await Promise.all(\n      children.map(f => findJavaScriptProjectFilesInRoot(path.join(root, f)))\n    );\n\n    return [].concat.apply([], jsFilesInChildren);\n  } else {\n    // lol it's not a file or directory, we can't return a honey badger, 'cause it don't give a\n    return [];\n  }\n}\n\neject()\n  .then(() => {\n    // the expo local github auth server leaves a setTimeout for 5 minutes\n    // so we need to explicitly exit (for now, this will be resolved in the nearish future)\n    process.exit(0);\n  })\n  .catch(e => {\n    console.error(`Problem running eject: ${e}`);\n    process.exit(1);\n  });\n"]}