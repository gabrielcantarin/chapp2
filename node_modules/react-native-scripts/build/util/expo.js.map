{"version":3,"sources":["expo.js"],"names":["loginOrRegister","user","appJsonPath","path","join","process","cwd","JSON","fse","readFile","appJson","parse","expo","ios","bundleIdentifier","platform","console","log","chalk","cyan","inquirer","prompt","name","message","iosBundleIdentifier","android","package","androidPackage","writeFile","resolve","toString","pkgJson","main","devDependencies","scripts","start","build","eject","Detach","detachAsync","detach","yellow","UserManager","getCurrentUserAsync","currentUser","loggedInQuestions","type","green","nickname","choices","value","stayLoggedIn","logoutAsync","questions","action","githubAuthAsync","registerAsync","usernamePasswordAuthAsync","loginAsync","Error","validate","validator","answers","data","username","password","val","trim","registeredUser","AUTH_CLIENT_ID","initialize"],"mappings":"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","file":"expo.js","sourcesContent":["// @flow\n\nimport chalk from 'chalk';\nimport fse from 'fs-extra';\nimport inquirer from 'inquirer';\nimport path from 'path';\nimport install from '../util/install';\n\nimport { Detach, User as UserManager, Versions } from 'xdl';\n\nimport type { User } from 'xdl/build/User';\n\nconst AUTH_CLIENT_ID = 'MGQh3rK3WZFWhJ91BShagHggMOhrE6nR';\nUserManager.initialize(AUTH_CLIENT_ID);\n\nexport async function detach() {\n  const user = await loginOrRegister();\n\n  const appJsonPath = path.join(process.cwd(), 'app.json');\n  const appJson = JSON.parse(await fse.readFile(appJsonPath));\n\n  if ((!appJson.expo.ios || !appJson.expo.ios.bundleIdentifier) && process.platform === 'darwin') {\n    console.log(\n      `\nYou'll need to specify an iOS bundle identifier. It must be unique on the App Store if you want to\npublish it there. See this StackOverflow question for more information:\n  ${chalk.cyan('https://stackoverflow.com/questions/11347470/what-does-bundle-identifier-mean-in-the-ios-project')}\n`\n    );\n    const { iosBundleIdentifier } = await inquirer.prompt([\n      {\n        name: 'iosBundleIdentifier',\n        message: 'What would you like your iOS bundle identifier to be?',\n      },\n    ]);\n\n    appJson.expo.ios = appJson.expo.ios || {};\n    appJson.expo.ios.bundleIdentifier = iosBundleIdentifier;\n  }\n\n  // check for android.package field, prompt interactively\n  if (!appJson.expo.android || !appJson.expo.android.package) {\n    console.log(\n      `\nYou'll need to specify an Android package name. It must be unique on the Play Store if you want to\npublish it there. See this StackOverflow question for more information:\n  ${chalk.cyan('https://stackoverflow.com/questions/6273892/android-package-name-convention')}\n`\n    );\n\n    const { androidPackage } = await inquirer.prompt([\n      {\n        name: 'androidPackage',\n        message: 'What would you like your Android package name to be?',\n      },\n    ]);\n\n    appJson.expo.android = appJson.expo.android || {};\n    appJson.expo.android.package = androidPackage;\n  }\n\n  // update app.json file with new contents\n  await fse.writeFile(appJsonPath, JSON.stringify(appJson, null, 2));\n\n  const pkgJson = JSON.parse((await fse.readFile(path.resolve('package.json'))).toString());\n  pkgJson.main = 'node_modules/expo/AppEntry.js';\n  delete pkgJson.devDependencies['react-native-scripts'];\n  delete pkgJson.scripts.start;\n  delete pkgJson.scripts.build;\n  delete pkgJson.scripts.eject;\n  delete pkgJson.scripts.android;\n  delete pkgJson.scripts.ios;\n  await fse.writeFile('package.json', JSON.stringify(pkgJson, null, 2));\n\n  await Detach.detachAsync(process.cwd());\n\n  console.log(\n    `\n  You'll need to use Expo's XDE or exp to run this project:\n    ${chalk.cyan('https://docs.expo.io/versions/latest/introduction/installation.html')}\n\n  For further instructions, please read ExpoKit's build documentation:\n    ${chalk.cyan('https://docs.expo.io/versions/latest/guides/expokit.html')}\n  `\n  );\n}\n\nasync function loginOrRegister(): Promise<?User> {\n  console.log(chalk.yellow('\\nAn Expo account is required to proceed.\\n'));\n  const currentUser = await UserManager.getCurrentUserAsync();\n\n  if (currentUser) {\n    const loggedInQuestions = [\n      {\n        type: 'list',\n        name: 'stayLoggedIn',\n        message: `It appears you're already logged in to Expo as \\\n${chalk.green(currentUser.nickname)}, would you like to continue with this account?`,\n        choices: [\n          {\n            name: `Yes, continue as ${currentUser.nickname}.`,\n            value: true,\n          },\n          {\n            name: \"No, I'd like to start a new session.\",\n            value: false,\n          },\n        ],\n      },\n    ];\n\n    const { stayLoggedIn } = await inquirer.prompt(loggedInQuestions);\n\n    if (stayLoggedIn) {\n      return currentUser;\n    } else {\n      await UserManager.logoutAsync();\n      console.log(chalk.green('\\nSuccessfully logged out!\\n'));\n    }\n  }\n\n  const questions = [\n    {\n      type: 'list',\n      name: 'action',\n      message: 'How would you like to authenticate?',\n      choices: [\n        {\n          name: 'Make a new Expo account',\n          value: 'register',\n        },\n        {\n          name: 'Log in with an existing Expo account',\n          value: 'existingUser',\n        },\n        {\n          name: 'Cancel',\n          value: 'cancel',\n        },\n      ],\n    },\n  ];\n\n  const { action } = await inquirer.prompt(questions);\n\n  if (action === 'github') {\n    return await githubAuthAsync();\n  } else if (action === 'register') {\n    return await registerAsync();\n  } else if (action === 'existingUser') {\n    return await usernamePasswordAuthAsync();\n  } else {\n    return null;\n  }\n}\n\nasync function githubAuthAsync(): Promise<User> {\n  let user = await UserManager.loginAsync('github');\n  if (user) {\n    console.log(chalk.green(`\\nSuccessfully logged in as ${user.nickname} with GitHub!`));\n    return user;\n  } else {\n    throw new Error('Unexpected Error: No user returned from the API');\n  }\n}\n\nfunction validator(val: string): boolean {\n  if (val.trim() === '') {\n    return false;\n  }\n  return true;\n}\n\nasync function usernamePasswordAuthAsync(): Promise<User> {\n  const questions = [\n    {\n      type: 'input',\n      name: 'username',\n      message: 'Username/Email Address:',\n      validate: validator,\n    },\n    {\n      type: 'password',\n      name: 'password',\n      message: 'Password:',\n      validate: validator,\n    },\n  ];\n\n  const answers = await inquirer.prompt(questions);\n\n  const data = {\n    username: answers.username,\n    password: answers.password,\n  };\n\n  let user = await UserManager.loginAsync('user-pass', data);\n\n  if (user) {\n    console.log(chalk.green(`\\nSuccessfully logged in as ${user.nickname}!`));\n    return user;\n  } else {\n    throw new Error('Unexpected Error: No user returned from the Expo API');\n  }\n}\n\nasync function registerAsync(): Promise<User> {\n  console.log(\n    `\nThanks for signing up for Expo!\nJust a few questions:\n`\n  );\n\n  const questions = [\n    {\n      type: 'input',\n      name: 'givenName',\n      message: 'First (Given) Name:',\n      validate: validator,\n    },\n    {\n      type: 'input',\n      name: 'familyName',\n      message: 'Last (Family) Name:',\n      validate: validator,\n    },\n    {\n      type: 'input',\n      name: 'username',\n      message: 'Username:',\n      validate: validator,\n    },\n    {\n      type: 'input',\n      name: 'email',\n      message: 'Email Address:',\n      validate: validator,\n    },\n    {\n      type: 'password',\n      name: 'password',\n      message: 'Password:',\n      validate: validator,\n    },\n    {\n      type: 'password',\n      name: 'passwordRepeat',\n      message: 'Password Repeat:',\n      validate(val, answers) {\n        if (val.trim() === '') {\n          return false;\n        }\n        if (val.trim() !== answers.password.trim()) {\n          return `Passwords don't match!`;\n        }\n        return true;\n      },\n    },\n  ];\n\n  const answers = await inquirer.prompt(questions);\n\n  const registeredUser = await UserManager.registerAsync({\n    ...answers,\n  });\n\n  console.log(chalk.green('\\nRegistration successful!'));\n\n  return registeredUser;\n}\n"]}